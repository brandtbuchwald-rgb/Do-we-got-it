function collectGearStats(prefix) {
  let stats = [];
  for (let i = 1; i <= 4; i++) {
    let type = document.getElementById(`${prefix}_stat${i}`).value;
    let val = parseFloat(document.getElementById(`${prefix}_val${i}`).value) || 0;
    stats.push({ type, val });
  }
  return stats;
}

function sumStats(allGearStats) {
  let totals = {};
  allGearStats.forEach(piece => {
    piece.forEach(line => {
      if (!totals[line.type]) totals[line.type] = 0;
      totals[line.type] += line.val;
    });
  });
  return totals;
}

buildBtn.addEventListener("click", () => {
  let helmStats = collectGearStats("helm");
  let armorStats = collectGearStats("armor");
  let glovesStats = collectGearStats("gloves");
  let bootsStats = collectGearStats("boots");
  let weaponStats = collectGearStats("weapon");

  let totals = sumStats([helmStats, armorStats, glovesStats, bootsStats, weaponStats]);

  canvas.width = 480;
  canvas.height = 640;
  ctx.fillStyle = "#1a1a1a";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#ffd700";
  ctx.font = "20px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Hunter Gear Sheet", 240, 40);

  ctx.textAlign = "left";
  ctx.fillStyle = "#66ccff";
  ctx.font = "16px Arial";
  let y = 100;
  ctx.fillText("Totals:", 40, y);
  y += 30;
  Object.entries(totals).forEach(([type, val]) => {
    ctx.fillText(`${type}: ${val}%`, 40, y);
    y += 25;
  });
});

// Reset
resetBtn.addEventListener("click", () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
});

// Download
downloadBtn.addEventListener("click", () => {
  const link = document.createElement("a");
  link.download = "hunter_gear_sheet.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});

// Tab switching
document.querySelectorAll(".tablink").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tablink").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".tabcontent").forEach(c => c.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});
